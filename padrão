import telegram
import logging
import json
from telegram.ext import Updater
from telegram.ext import CommandHandler


bot = telegram.Bot(token='667895949:AAFa5ic_yU0boRWKCh5EKe7vlE08fjAHQYM')
print(bot.get_me())
updater = Updater(token='667895949:AAFa5ic_yU0boRWKCh5EKe7vlE08fjAHQYM')
dispatcher = updater.dispatcher
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level = logging.INFO)


def start(bot, update):  # linha de chama de função, se atentar à mudanças.
    text_caps = main(bot, update)
    bot.send_message(chat_id=update.message.chat_id, text=text_caps)

start_handler = CommandHandler('start', start)
dispatcher.add_handler(start_handler)


def caps(bot, update, args):
    text_caps = ' '.join(args).upper()
    bot.send_message(chat_id=update.message.chat_id, text=text_caps)

caps_handler = CommandHandler('caps', caps, pass_args=True)
dispatcher.add_handler(caps_handler)


def main(bot, update):
    me = bot.get_me()

    # Welcome message
    msg = "Oi!\n"
    msg += "Meu nome é {0} e estou aqui para ajuda-lo.\n".format(me.first_name)
    msg += "O que você gostaria de fazer?\n\n"
    msg += "/support - Abre o menu de suporte\n"
    msg += "/settings - Abre o menu de configurações\n\n"

    # Commands menu
    main_menu_keyboard = [[telegram.KeyboardButton('/support')],
                          [telegram.KeyboardButton('/settings')]]
    reply_kb_markup = telegram.ReplyKeyboardMarkup(main_menu_keyboard,
                                                   resize_keyboard=True,
                                                   one_time_keyboard=True)

    # Send the message with menu
    bot.send_message(chat_id=update.message.chat_id,
                     text=msg,
                     reply_markup=reply_kb_markup)
    return main

updater.start_polling()
